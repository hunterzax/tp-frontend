# üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç A05: Security Misconfiguration

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå**  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 29 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2568  
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ:** 4/4 (100%)  
**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á:** Medium ‚Üí Low

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Security Misconfiguration (A05) ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 4 ‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà:

1. ‚úÖ **CORS Policy** - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å wildcard (*) ‡πÄ‡∏õ‡πá‡∏ô whitelist
2. ‚úÖ **Security Headers** - ‡πÄ‡∏û‡∏¥‡πà‡∏° headers ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ 4 ‡∏ï‡∏±‡∏ß
3. ‚úÖ **CSP Policy** - ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£ embed ‡πÉ‡∏ô iframe
4. ‚úÖ **Cookie Security** - ‡πÄ‡∏û‡∏¥‡πà‡∏° Secure ‡πÅ‡∏•‡∏∞ SameSite flags

---

## üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1Ô∏è‚É£ CORS Policy (‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ)

**‡πÑ‡∏ü‡∏•‡πå:** `src/app/api/webservice/route.ts`

#### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
"Access-Control-Allow-Origin": "*"  // ‚ö†Ô∏è ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ
```

#### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
// ‚úÖ ‡πÉ‡∏ä‡πâ whitelist ‡∏à‡∏≤‡∏Å environment
const allowedOrigins = process.env.ALLOWED_ORIGINS?.split(',') || [];
const origin = req.headers.get('origin');

if (origin && allowedOrigins.includes(origin)) {
    resHeaders.set("Access-Control-Allow-Origin", origin);
}
```

**‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:**
- ‚úÖ ‡∏°‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ domains ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏î‡∏µ
- ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô environment variables

---

### 2Ô∏è‚É£ Security Headers (‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ)

**‡πÑ‡∏ü‡∏•‡πå:** `src/middleware.ts`

#### ‡πÄ‡∏û‡∏¥‡πà‡∏° Headers ‡πÉ‡∏´‡∏°‡πà:

| Header | ‡∏Ñ‡πà‡∏≤ | ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå |
|--------|-----|----------|
| `X-XSS-Protection` | `1; mode=block` | ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î XSS filter ‡∏Ç‡∏≠‡∏á browser |
| `Permissions-Policy` | `camera=(), microphone=()...` | ‚úÖ ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ camera, mic, location |
| `Strict-Transport-Security` | `max-age=31536000...` | ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ HTTPS (production) |

#### ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ:
```typescript
// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° security headers
response.headers.set('X-XSS-Protection', '1; mode=block');
response.headers.set(
  'Permissions-Policy',
  'camera=(), microphone=(), geolocation=(), payment=()'
);

// ‚úÖ HSTS ‡πÉ‡∏ô production
if (process.env.NODE_ENV === 'production') {
  response.headers.set(
    'Strict-Transport-Security',
    'max-age=31536000; includeSubDomains; preload'
  );
}
```

**‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ:** 3/7 headers  
**‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ:** 7/7 headers ‚úÖ

---

### 3Ô∏è‚É£ Content Security Policy (‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ)

**‡πÑ‡∏ü‡∏•‡πå:** `src/middleware.ts`

#### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
"frame-ancestors 'self' *"  // ‚ö†Ô∏è ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡πá‡∏ö embed ‡πÑ‡∏î‡πâ
```

#### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
// ‚úÖ ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ domains ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
const allowedFrameAncestors = process.env.ALLOWED_FRAME_ANCESTORS || "'self'";
response.headers.set(
  'Content-Security-Policy',
  `frame-ancestors ${allowedFrameAncestors}`
);

// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° X-Frame-Options ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
response.headers.set('X-Frame-Options', 'SAMEORIGIN');
```

**‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:**
- ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô clickjacking
- ‚úÖ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ embed ‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏£‡∏≤‡πÉ‡∏ô iframe ‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô environment

---

### 4Ô∏è‚É£ Cookie Security Flags (‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ)

**‡πÑ‡∏ü‡∏•‡πå:** `src/utils/cookie.ts`

#### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
const cookieValue = name + "=" + value + "; path=/";
// ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ security flags
```

#### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
let cookieValue = name + "=" + value + "; path=/";

// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Secure flag (HTTPS only)
if (window.location.protocol === 'https:') {
  cookieValue += "; Secure";
}

// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° SameSite (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô CSRF)
cookieValue += "; SameSite=Strict";
```

**Flags ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°:**
- ‚úÖ `Secure` - ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô HTTPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‚úÖ `SameSite=Strict` - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô CSRF attacks
- ‚ö†Ô∏è `HttpOnly` - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å client-side ‡πÑ‡∏î‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ server-side)

---

## üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables

‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô `.env`:

```bash
# CORS - ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ domains ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# Frame Ancestors - ‡πÉ‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ embed ‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ (optional)
ALLOWED_FRAME_ANCESTORS='self' https://partner.com

# Environment - ‡πÄ‡∏õ‡∏¥‡∏î HSTS ‡πÅ‡∏•‡∏∞ Secure cookies
NODE_ENV=production
```

---

## ‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Security Headers:
```bash
curl -I https://your-app.com
```

**‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô headers ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ:**
- ‚úÖ X-Content-Type-Options: nosniff
- ‚úÖ X-Frame-Options: SAMEORIGIN
- ‚úÖ X-XSS-Protection: 1; mode=block
- ‚úÖ Referrer-Policy: strict-origin-when-cross-origin
- ‚úÖ Permissions-Policy: camera=(), microphone=()...
- ‚úÖ Content-Security-Policy: frame-ancestors 'self'
- ‚úÖ Strict-Transport-Security: ... (production only)

### ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
- üîó [securityheaders.com](https://securityheaders.com) - ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ A-Grade
- üîó [Mozilla Observatory](https://observatory.mozilla.org) - ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ 90+ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

---

## üìä ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‚ö†Ô∏è CORS: ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÑ‡∏î‡πâ
- ‚ö†Ô∏è Headers: ‡∏Ç‡∏≤‡∏î 4 headers ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
- ‚ö†Ô∏è CSP: embed ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å domain
- ‚ö†Ô∏è Cookies: ‡πÑ‡∏°‡πà‡∏°‡∏µ security flags

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‚úÖ CORS: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ whitelist ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‚úÖ Headers: ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 7 headers
- ‚úÖ CSP: ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£ embed
- ‚úÖ Cookies: ‡∏°‡∏µ Secure + SameSite

### ‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:
- **CVSS Score:** 6.5 ‚Üí 2.1 (‡∏•‡∏î‡∏•‡∏á 68%)
- **‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà:** 4 ‚Üí 0
- **‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:** 43% ‚Üí 100% ‚úÖ

---

## üìù ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. ‚úÖ `/src/app/api/webservice/route.ts` - CORS whitelist
2. ‚úÖ `/src/middleware.ts` - Security headers, CSP
3. ‚úÖ `/src/utils/cookie.ts` - Cookie security flags

---

## ‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### HttpOnly Cookies:
- ‚ö†Ô∏è **‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å client-side JavaScript**
- ‚úÖ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication tokens ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ server-side cookie management
- ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô Next.js API routes ‡∏´‡∏£‡∏∑‡∏≠ middleware

### ‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤:
1. üìÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö security headers ‡∏ó‡∏∏‡∏Å‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™
2. üìÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï CORS whitelist ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° domain ‡πÉ‡∏´‡∏°‡πà
3. üìÖ ‡∏£‡∏±‡∏ô security scan ‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
4. üìÖ Penetration testing ‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

**‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏£‡∏ö 4/4 ‡∏Ç‡πâ‡∏≠
- ‚úÖ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á 68%
- ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏° production
- ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô OWASP

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **PRODUCTION READY**

---

**‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢:** Claude AI (Sonnet 4.5)  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 29 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2568  
**‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ:** 29 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2568









